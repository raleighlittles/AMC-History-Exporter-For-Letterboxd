import requests
import sys
import pdb

if __name__ == "__main__":

    amc_url = "https://graph.amctheatres.com/"

    request_headers = {

        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "en-US,en;q=0.9",
        "Cache-Control": "no-cache",
        "Connection": "keep-alive",
        "Content-Length": "19572",
        "content-type": "application/json",
        "Host": "graph.amctheatres.com",
        "Origin": "https://www.amctheatres.com",
        "Pragma": "no-cache",
        "Referer": "https://www.amctheatres.com/amcstubs/history",
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": "Linux",
        "Sec-Fetch-Dest": "empty",
        "Sec-Fetch-Mode": "cors",
        "Sec-Fetch-Site": "same-site",
        "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36",
        # Cookies
        "Cookie": "authToken=Dnx69gnYA%2FkTn8NQgZDqxTRggxCbuCTU%2Bc1D5PYrzuUAfJaBa7Q2FAZZTMCtZyUWqgRSRQPDGD8p0UXrBpDicqtlb9mhkQleZx2HolpIs3dqvwHgQNVTJ8cO9TrSRzNV%2FiiEs4XoySHnc8RAc2v5MIKXWBHfb3CQGvWqbpjHkhUD1lwFErrP61ALJWqoRj4BZQs1XZFtqZnFa7FYVhrkJLfumXws4WhNWw%2ByTTJE77Apahp48leK8AuZwwk8rRqncpp7rrdpo51iE%2BOjdRwarMDyXRsToA%2Bl0F%2BsAfZW; connect.sid=s%3AU1dOGUyt8xPo0R-cRl2_deLRA7tBVuwH.tvD7ulBWTxkn44sNu3YxVnAFv%2BevP49ndDNdPXS6Sbg; TS01c7b029=01a483b97104ca6889edf36badca9c3473b7a12808ea4feeb6cb0e084db66ca4d465a1a23cadbc58c6e6e9e7733b62a2823681dd96; TS01e39824=01a483b971aabd7bb74cf3125535620160e11679b902fabfdf3c87cde76513f892f2ab852444b8f4961e957e529ba52d3c48cdac01; f5avraaaaaaaaaaaaaaaa_session_=HIMMGCJMDNNIIHLIBPLPLIMEMLHFKINFMKNKBLAIJNGDDFDJJICDFLEBGHLBBEBPPAHDCDNGDLDLLENNIJGAAMEMMELEGLCIDOIFJINDFDGIJJDMIKCNGGONOKOPOPGO; TS0149c298=01a483b971846dabd410c89da7efee90ef1045c00a29afb8da508517c13676859be4e8cf35e92998586cfd031c07a16294e6e443d9",
        "x-amc-request-id": "15793db2-adef-463b-bb08-9713f8eb1a9b"
        
    }


    movie_history_request_payload = {"operationName":"History","variables":{"orderHistoryStartDate":"2022-11-28","orderHistoryEndDate":"2022-12-29","maxNumberOrderHistoryRecords":999},"query":"query History($orderHistoryStartDate: Date!, $orderHistoryEndDate: Date!, $maxNumberOrderHistoryRecords: Int!) {\n  viewer {\n    user {\n      account {\n        id\n        accountType\n        loyaltyUpgradeProduct {\n          id\n          cost\n          previousCost\n          __typename\n        }\n        orderHistory(startDate: $orderHistoryStartDate, endDate: $orderHistoryEndDate, first: $maxNumberOrderHistoryRecords) {\n          id\n          edges {\n            id\n            node {\n              id\n              createdDateUtc\n              totalPrice: total\n              groups {\n                id\n                type\n                typeDisplayNamePlural\n                confirmationCode\n                movie {\n                  id\n                  name\n                  runTime\n                  mpaaRating\n                  images(first: 2) {\n                    id\n                    edges {\n                      id\n                      node {\n                        id\n                        url\n                        contentType\n                        __typename\n                      }\n                      __typename\n                    }\n                    __typename\n                  }\n                  __typename\n                }\n                showtime {\n                  id\n                  status\n                  display {\n                    id\n                    date\n                    __typename\n                  }\n                  __typename\n                }\n                deliveryTimeDisplay {\n                  date\n                  __typename\n                }\n                __typename\n              }\n              orderGroup {\n                id\n                attendees {\n                  id\n                  __typename\n                }\n                id\n                __typename\n              }\n              ...CheckoutConfirmationMessage_Order\n              ...CheckoutOrderDetails_Order\n              ...CheckoutOrderSummary_Order\n              ...CheckoutTitleHeader_Order\n              ...ConfirmationFooter_Order\n              ...ConfirmationsContainer_Order\n              ...RefundLinkContainer_Order\n              ...RefundPaymentGroupsContainer_Order\n              ...EntourageNotification_Order\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        ...PromoBoxItems_Account\n        __typename\n      }\n      ...CheckoutOrderDetails_User\n      ...CheckoutOrderSummary_User\n      ...CheckoutTitleHeader_User\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment CheckoutConfirmationMessage_Order on Order {\n  id\n  accountId\n  groups {\n    id\n    type\n    typeDisplayNamePlural\n    confirmationCode\n    dodPricing {\n      id\n      isPreorder\n      __typename\n    }\n    items {\n      id\n      cost\n      sku\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment CheckoutOrderDetails_Order on Order {\n  id\n  ...AlternativePayments_Order\n  ...GroupContainer_Order\n  ...OrderTotal_Order\n  ...StubsRewardsMessage_Order\n  ...TotalTaxCharges_Order\n  ...EntourageNotification_Order\n  groups {\n    id\n    ...DiscountMatineePricing_OrderItemGroup\n    ...GroupContainer_OrderItemGroup\n    __typename\n  }\n  orderGroup {\n    id\n    attendees {\n      id\n      __typename\n    }\n    id\n    __typename\n  }\n  __typename\n}\n\nfragment AlternativePayments_Order on Order {\n  alternativePaymentsGroup {\n    id\n    title\n    charges {\n      ...Charge_Charge\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment Charge_Charge on Charge {\n  id\n  displayName\n  displayAmount\n  __typename\n}\n\nfragment DiscountMatineePricing_OrderItemGroup on OrderItemGroup {\n  id\n  showtime {\n    id\n    isDiscountMatineePriced\n    discountMatineeMessage\n    __typename\n  }\n  __typename\n}\n\nfragment GroupContainer_OrderItemGroup on OrderItemGroup {\n  displayName\n  displayDescription\n  ...AddMore_OrderItemGroup\n  ...EditTickets_OrderItemGroup\n  ...ItemContainer_OrderItemGroup\n  ...LoyaltyPromo_OrderItemGroup\n  additionalCharges {\n    ...GroupContainer_ChargeGroup\n    __typename\n  }\n  cancelledCharges {\n    ...GroupContainer_ChargeGroup\n    __typename\n  }\n  items {\n    ...ItemContainer_OrderItem\n    __typename\n  }\n  refundedCharges {\n    ...GroupContainer_ChargeGroup\n    __typename\n  }\n  waivedCharges {\n    ...GroupContainer_ChargeGroup\n    __typename\n  }\n  __typename\n}\n\nfragment AddMore_OrderItemGroup on OrderItemGroup {\n  type\n  theatre {\n    id\n    slug\n    __typename\n  }\n  __typename\n}\n\nfragment EditTickets_OrderItemGroup on OrderItemGroup {\n  type\n  canEditQuantity\n  items {\n    id\n    sku\n    tokens\n    __typename\n  }\n  showtime {\n    id\n    showtimeId\n    isPrivateRental\n    __typename\n  }\n  __typename\n}\n\nfragment ItemContainer_OrderItem on OrderItem {\n  charge {\n    ...Charge_Charge\n    __typename\n  }\n  ...Discounts_OrderItem\n  ...EditQuantity_OrderItem\n  ...ItemDescription_OrderItem\n  ...RemoveItem_OrderItem\n  __typename\n}\n\nfragment Discounts_OrderItem on OrderItem {\n  discounts {\n    promoCode\n    discountCharge {\n      ...Charge_Charge\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment EditQuantity_OrderItem on OrderItem {\n  displayDescription\n  name\n  quantity\n  sku\n  tokens\n  displayDescription\n  name\n  variant\n  __typename\n}\n\nfragment ItemDescription_OrderItem on OrderItem {\n  planTypeDescription\n  productSubscriptionDescription\n  quantity\n  components {\n    name\n    modifiers {\n      name\n      cost {\n        id\n        actual\n        USD\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  modifiers {\n    name\n    cost {\n      id\n      actual\n      USD\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment RemoveItem_OrderItem on OrderItem {\n  sku\n  tokens\n  name\n  variant\n  __typename\n}\n\nfragment ItemContainer_OrderItemGroup on OrderItemGroup {\n  ...EditQuantity_OrderItemGroup\n  ...RemoveItem_OrderItemGroup\n  __typename\n}\n\nfragment EditQuantity_OrderItemGroup on OrderItemGroup {\n  type\n  canEditQuantity\n  __typename\n}\n\nfragment RemoveItem_OrderItemGroup on OrderItemGroup {\n  type\n  canEditQuantity\n  __typename\n}\n\nfragment LoyaltyPromo_OrderItemGroup on OrderItemGroup {\n  theatre {\n    id\n    premiereProducts: productSubscriptions(subscriptionType: PREMIERE) {\n      id\n      items {\n        id\n        sku\n        cost\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment GroupContainer_ChargeGroup on ChargeGroup {\n  id\n  title\n  charges {\n    id\n    displayName\n    displayAmount\n    __typename\n  }\n  __typename\n}\n\nfragment GroupContainer_Order on Order {\n  addresses {\n    id\n    type\n    addressLine1\n    addressLine2\n    city\n    postalCode\n    state\n    __typename\n  }\n  ...AddMore_Order\n  ...EditTickets_Order\n  ...ItemContainer_Order\n  ...LoyaltyPromo_Order\n  __typename\n}\n\nfragment AddMore_Order on Order {\n  token\n  __typename\n}\n\nfragment EditTickets_Order on Order {\n  token\n  __typename\n}\n\nfragment ItemContainer_Order on Order {\n  ...EditQuantity_Order\n  ...RemoveItem_Order\n  __typename\n}\n\nfragment EditQuantity_Order on Order {\n  token\n  __typename\n}\n\nfragment RemoveItem_Order on Order {\n  token\n  __typename\n}\n\nfragment LoyaltyPromo_Order on Order {\n  accountId\n  waivableFeesTotalMinusTax {\n    id\n    actual\n    USD\n    __typename\n  }\n  __typename\n}\n\nfragment OrderTotal_Order on Order {\n  displayTotal\n  __typename\n}\n\nfragment StubsRewardsMessage_Order on Order {\n  id\n  status\n  areSubscriptionDiscountsWaived\n  groups {\n    id\n    type\n    items {\n      id\n      sku\n      hasTuesdayTicketDiscount\n      __typename\n    }\n    showtime {\n      id\n      showDateTimeUtc\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment TotalTaxCharges_Order on Order {\n  hasEstimatedTaxes\n  taxes {\n    id\n    actual\n    USD\n    __typename\n  }\n  __typename\n}\n\nfragment EntourageNotification_Order on Order {\n  areSubscriptionDiscountsWaived\n  isOrderGroupOrganizer\n  orderGroup {\n    id\n    attendees {\n      id\n      isOrganizer\n      name\n      refundableStatus {\n        id\n        isRefunded\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment CheckoutOrderDetails_User on User {\n  id\n  account {\n    id\n    ...GroupContainer_Account\n    ...StubsRewardsMessage_Account\n    requiresVerification\n    requiresVerificationReason\n    __typename\n  }\n  __typename\n}\n\nfragment GroupContainer_Account on Account {\n  ...LoyaltyPromo_Account\n  __typename\n}\n\nfragment LoyaltyPromo_Account on Account {\n  id\n  theatres {\n    id\n    premiereProducts: productSubscriptions(subscriptionType: PREMIERE) {\n      id\n      items {\n        id\n        sku\n        cost\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment StubsRewardsMessage_Account on Account {\n  hasAlistSubscription: hasProductSubscription(subscriptionType: A_LIST)\n  __typename\n}\n\nfragment CheckoutOrderSummary_Order on Order {\n  id\n  groups {\n    id\n    type\n    typeDisplayNamePlural\n    __typename\n  }\n  ...AListPhotoIDRequired_Order\n  ...EntourageNotification_Order\n  ...DateSummaryContainer_Order\n  ...FoodAndDrinkSummaryContainer_Order\n  ...ProductSubscriptionTicketSummaryContainer_Order\n  ...LocationSummaryContainer_Order\n  ...PaymentSummaryContainer_Order\n  ...ProductSubscriptionSummaryContainer_Order\n  ...QRCodeSummaryContainer_Order\n  ...TicketSummaryContainer_Order\n  ...DodSummaryContainer_Order\n  __typename\n}\n\nfragment AListPhotoIDRequired_Order on Order {\n  isPhotoIdRequired\n  groups {\n    id\n    items {\n      id\n      hasOnePassDiscount\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment DateSummaryContainer_Order on Order {\n  id\n  groups {\n    id\n    type\n    deliveryTimeDisplay {\n      time\n      date\n      amPm\n      __typename\n    }\n    showtime {\n      id\n      ...AddToCalendar_Showtime\n      error {\n        id\n        message\n        __typename\n      }\n      display {\n        id\n        prefix\n        date\n        time\n        amPm\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment AddToCalendar_Showtime on Showtime {\n  calendarLinks {\n    id\n    text\n    href\n    __typename\n  }\n  __typename\n}\n\nfragment FoodAndDrinkSummaryContainer_Order on Order {\n  id\n  groups {\n    id\n    type\n    concessionsOrderName\n    deliveryType\n    deliverySeatName\n    deliveryTimeDisplay {\n      id\n      time\n      amPm\n      __typename\n    }\n    deliveryTimeDisplay {\n      id\n      time\n      amPm\n      __typename\n    }\n    items {\n      id\n      quantifiedDisplayName\n      displayDescription\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment ProductSubscriptionSummaryContainer_Order on Order {\n  id\n  isGiftRedemption\n  groups {\n    id\n    items {\n      id\n      cost\n      name\n      nextBillDate {\n        id\n        dateShort\n        __typename\n      }\n      sku\n      __typename\n    }\n    type\n    __typename\n  }\n  __typename\n}\n\nfragment ProductSubscriptionTicketSummaryContainer_Order on Order {\n  groups {\n    id\n    items {\n      id\n      hasProductSubscriptionDiscount\n      hasOnePassDiscount\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment LocationSummaryContainer_Order on Order {\n  id\n  groups {\n    id\n    theatre {\n      id\n      addressLine1\n      city\n      directionsUrl\n      guestServicesPhoneNumber\n      name\n      postalCode\n      stateCode\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment PaymentSummaryContainer_Order on Order {\n  groups {\n    id\n    items {\n      id\n      hasProductSubscriptionDiscount\n      __typename\n    }\n    __typename\n  }\n  paymentGroups {\n    id\n    group\n    payments {\n      id\n      amount\n      cardNumberLast4\n      externalUserName\n      type\n      displayName\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment QRCodeSummaryContainer_Order on Order {\n  id\n  groups {\n    id\n    confirmationQrCodeUrl\n    items {\n      id\n      hasOnePassDiscount\n      __typename\n    }\n    __typename\n  }\n  ...accountUtils_Order\n  __typename\n}\n\nfragment accountUtils_Order on Order {\n  groups {\n    id\n    items {\n      id\n      hasProductSubscriptionDiscount\n      nextBillDate {\n        id\n        monthDayYear\n        dateShort\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment TicketSummaryContainer_Order on Order {\n  id\n  groups {\n    id\n    auditorium\n    reservedSeats\n    typeDisplayNamePlural\n    items {\n      name\n      quantity\n      __typename\n    }\n    showtime {\n      id\n      isPrivateRental\n      maximumIntendedAttendance\n      attributes(first: 100) {\n        id\n        edges {\n          id\n          node {\n            id\n            name\n            code\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment DodSummaryContainer_Order on Order {\n  id\n  groups {\n    id\n    type\n    onDemandProductEntitlementType\n    onDemandProductResolution\n    movie {\n      id\n      name\n      dodProductContext {\n        id\n        available\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment CheckoutOrderSummary_User on User {\n  id\n  account {\n    ...ProductSubscriptionSummaryContainer_Account\n    ...ProductSubscriptionTicketSummaryContainer_Account\n    __typename\n  }\n  __typename\n}\n\nfragment ProductSubscriptionSummaryContainer_Account on Account {\n  hasAlistSubscription: hasProductSubscription(subscriptionType: A_LIST)\n  alistSubscription: productSubscription(subscriptionType: A_LIST) {\n    id\n    renewalCost {\n      id\n      USD\n      __typename\n    }\n    nextBillDate {\n      id\n      dateShort\n      __typename\n    }\n    __typename\n  }\n  hasPremiereSubscription: hasProductSubscription(subscriptionType: PREMIERE)\n  premiereSubscription: productSubscription(subscriptionType: PREMIERE) {\n    id\n    renewalCost {\n      id\n      USD\n      __typename\n    }\n    nextBillDate {\n      id\n      dateShort\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment ProductSubscriptionTicketSummaryContainer_Account on Account {\n  id\n  firstName\n  lastName\n  accountType\n  hasAlistSubscription: hasProductSubscription(subscriptionType: A_LIST)\n  __typename\n}\n\nfragment CheckoutTitleHeader_Order on Order {\n  ...ResendGift_Order\n  id\n  isGiftRedemption\n  token\n  ticketCount\n  groups {\n    id\n    type\n    auditorium\n    reservedSeats\n    typeDisplayNamePlural\n    confirmationQrCodeUrl\n    onDemandProductEntitlementType\n    onDemandProductResolution\n    privateShowingMovie {\n      id\n      name\n      ...CheckoutTitleHeader_Movie\n      __typename\n    }\n    dodPricing {\n      id\n      isPreorder\n      __typename\n    }\n    movie {\n      id\n      movieId\n      name\n      websiteUrl\n      mpaaRating\n      runTime\n      dodProduct {\n        id\n        runTime\n        mpaaRating\n        __typename\n      }\n      ...CheckoutTitleHeader_Movie\n      __typename\n    }\n    showtime {\n      id\n      isPrivateRental\n      isReservedSeating\n      checkoutTitleHeaderAttributes: attributes(type: PREMIUM, groups: [FORMAT], first: 1) {\n        id\n        edges {\n          id\n          node {\n            id\n            code\n            name\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      display {\n        id\n        prefix\n        date\n        time\n        dateShort\n        amPm\n        __typename\n      }\n      __typename\n    }\n    theatre {\n      id\n      name\n      __typename\n    }\n    items {\n      id\n      description\n      sku\n      hasProductSubscriptionDiscount\n      giftRecipientEmail\n      voucherDurationMonths\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment ResendGift_Order on Order {\n  id\n  groups {\n    id\n    items {\n      id\n      giftRecipientEmail\n      __typename\n    }\n    __typename\n  }\n  token\n  __typename\n}\n\nfragment CheckoutTitleHeader_Movie on IMovie {\n  hero: image(contentType: HeroDesktopDynamic) {\n    id\n    url\n    __typename\n  }\n  poster: preferredPoster {\n    id\n    url\n    __typename\n  }\n  __typename\n}\n\nfragment CheckoutTitleHeader_User on User {\n  id\n  account {\n    id\n    accountType\n    displayName\n    hasAlistSubscription: hasProductSubscription(subscriptionType: A_LIST)\n    hasPremiereSubscription: hasProductSubscription(subscriptionType: PREMIERE)\n    loyaltyCard {\n      id\n      cardNumber\n      expirationDateDisplay {\n        id\n        date\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment ConfirmationFooter_Order on Order {\n  ...ProfileButton_Order\n  id\n  isGiftRedemption\n  groups {\n    id\n    type\n    typeDisplayNamePlural\n    confirmationCode\n    items {\n      id\n      sku\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment ProfileButton_Order on Order {\n  id\n  groups {\n    id\n    type\n    __typename\n  }\n  __typename\n}\n\nfragment ConfirmationsContainer_Order on Order {\n  id\n  orderId\n  groups {\n    id\n    type\n    confirmationCode\n    items {\n      id\n      sku\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment PromoBoxItems_Account on Account {\n  id\n  accountId\n  accountType\n  theatres {\n    theatreId\n    isFavorite\n    __typename\n  }\n  loyaltyUpgradeProduct {\n    id\n    cost\n    previousCost\n    __typename\n  }\n  ...getPremiereProductSku_Account\n  __typename\n}\n\nfragment getPremiereProductSku_Account on Account {\n  id\n  theatres {\n    id\n    theatreId\n    isFavorite\n    __typename\n  }\n  __typename\n}\n\nfragment RefundLinkContainer_Order on Order {\n  isOrderGroupOrganizer\n  token\n  status\n  refundableType\n  orderGroup {\n    id\n    attendees {\n      id\n      refundableStatus {\n        id\n        selfServiceRefundable\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment RefundPaymentGroupsContainer_Order on Order {\n  refundedPaymentGroups {\n    id\n    isPending\n    refundStatus\n    status\n    refundedPayments {\n      id\n      amount\n      cardNumberLast4\n      externalUserName\n      displayAmount\n      tenderType\n      type\n      displayName\n      __typename\n    }\n    refundDate {\n      id\n      monthDateShort\n      prefix\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n"}

    session = requests.Session()
    response = session.post(amc_url, headers=request_headers, data=movie_history_request_payload)

    try:
        response.raise_for_status()

    except requests.HTTPError as e:
        print("Error with POST request: ", e)
        sys.exit(1)


    pdb.set_trace()